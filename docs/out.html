<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>Underscore.lua</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-type' />
    <link href='css/reset.css' rel='stylesheet' type='text/css' />
    <link href='css/text.css' rel='stylesheet' type='text/css' />
    <link href='css/960.css' rel='stylesheet' type='text/css' />
    <link href='css/main.css' rel='stylesheet' type='text/css' />
    <script src='js/shBrushLua.js'></script>
  </head>
  <body>
    <a href='http://github.com/mirven/underscore.lua'>
      <img alt='Fork me on GitHub' src='http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png' style='position: absolute; top: 0; right: 0; border: 0;' />
    </a>
    <div class='container_12'>
      <div class='grid_3 function_index'>
        <h3>Map Functions</h3>
        <ul>
          <li>
            <a href='#map'>map</a>
          </li>
          <li>
            <a href='#each'>each</a>
          </li>
          <li>
            <a href='#select'>select</a>
          </li>
          <li>
            <a href='#reject'>reject</a>
          </li>
          <li>
            <a href='#invoke'>invoke</a>
          </li>
          <li>
            <a href='#pluck'>pluck</a>
          </li>
        </ul>
        <h3>Reduce Functions</h3>
        <ul>
          <li>
            <a href='#to_array'>to_array</a>
          </li>
          <li>
            <a href='#sort'>sort</a>
          </li>
        </ul>
        <h3>Table Functions</h3>
        <ul>
          <li>
            <a href='#extend'>extend</a>
          </li>
        </ul>
        <h3>Function Functions</h3>
        <ul>
          <li>
            <a href='#wrap'>wrap</a>
          </li>
        </ul>
      </div>
      <div class='grid_7'>
        <h1>Underscore.lua</h1>
        <p>
          Underscore.lua is a Lua library that provides a set of utility functions for dealing with
          iterators, arrays, tables, and functions. It is <b>heavily</b> inspired by
          <a href="http://documentcloud.github.com/underscore">Underscore.js</a>. Although the code was
          not referenced during the writing of this library the documentation, examples, and api are basically
          ripped off from them.
        </p>
        <h2>Installing</h2>
        <p>
          It can be installed with
          <a href='http://www.luarocks.org'>LuaRocks</a>
          via:
          <code>luarocks install underscore.lua --from=http://marcusirven.s3.amazonaws.com/rocks/</code>
        </p>
        <p>
          Alternatively underscore.lua can be downloaded directly from
          <a href='http://github.com/mirven/underscore.lua/raw/0.2-1/lib/underscore.lua'>here.</a>
        </p>
        <p>
          The source code is
          <a href='http://github.com/mirven/underscore.lua'>available</a>
          at Github.
        </p>
        <h2>Object-Oriented and Functional Styles</h2>
        <p>
          You can use Underscore in either an object-oriented or a functional style,
          depending on your preference. The following two lines of code are identical
          ways to double a list of numbers.
        </p>
        <pre>_.map({1, 2, 3}, function(n) return n * 2 end)&#x000A;_({1, 2, 3}):map(function(n) return n * 2 end)&#x000A;</pre>
        <p>
          Using the object-oriented style allows you to chain together methods. Calling chain on a
          wrapped object will cause all future method calls to return wrapped objects as well. When
          you've finished the computation, use value to retrieve the final value. Here's an example
          of chaining together a map/flatten/reduce, in order to get the word count of every word in a song.
        </p>
        <pre>local lyrics = {&#x000A;  { line = 1, words = "I'm a lumberjack and I'm okay" },&#x000A;  { line = 2, words = "I sleep all night and I work all day" },&#x000A;  { line = 3, words = "He's a lumberjack and he's okay" },&#x000A;  { line = 4, words = "He sleeps all night and he works all day" }&#x000A;}&#x000A;&#x000A;_(lyrics):chain()&#x000A;  :map(function(line) &#x000A;    local words = {}&#x000A;    for w in line.words:gmatch("%S+") do&#x000A;      words[#words+1] = w   &#x000A;    end&#x000A;    return words&#x000A;  end)&#x000A;  :flatten()&#x000A;  :reduce({}, function(counts, word)&#x000A;    counts[word] = (counts[word] or 0) + 1&#x000A;    return counts&#x000A;  end):value()</pre>
        <p>Note: This can be written even more succinctly as (notice the map function):</p>
        <pre>_(lyrics):chain()&#x000A;  :map(function(line) return _.to_array(line.words:gmatch("%S+")) end)&#x000A;  :flatten()&#x000A;  :reduce({}, function(counts, word)&#x000A;    counts[word] = (counts[word] or 0) + 1&#x000A;    return counts&#x000A;  end):value()&#x000A;</pre>
        <h2>Functions</h2>
        <h3>Map Functions</h3>
        <div id='map'>
          <p>
            <strong>map</strong>
            <code>_.map(iter, func)</code>
          </p>
          <p class='description'>Produces a new array by mapping each value in iter through a transformation function.</p>
          <pre>_.map({1,2,3}, function(i) return i*2 end)</pre>
        </div>
        <div id='each'>
          <p>
            <strong>each</strong>
            <code>_.each(iter, func)</code>
          </p>
          <p class='description'>Passes each value to function(i) and returns the input.</p>
          <pre>_.each({1,2,3}, print)&#x000A;=> {1,2,3}</pre>
        </div>
        <div id='select'>
          <p>
            <strong>select</strong>
            <code>_.select(iter, func)</code>
          </p>
          <p class='description'>Removes items that do not match the provided criteria.</p>
          <pre>_.select({1,2,3}, function(i) return i%2 == 1 end)&#x000A;=> {1,3}</pre>
        </div>
        <div id='reject'>
          <p>
            <strong>reject</strong>
            <code>_.reject(iter, func)</code>
          </p>
          <p class='description'>Removes items that match the provided criteria.</p>
          <pre>_.reject({1,2,3}, function(i) return i%2 == 1 end)&#x000A;=> {2}</pre>
        </div>
        <div id='invoke'>
          <p>
            <strong>invoke</strong>
            <code>_.invoke(foo, blah)</code>
          </p>
          <p class='description'>Calls a function with specified name on each item using the colon operator.</p>
          <pre>Person = {}&#x000A;Person.__index = Person &#x000A;function Person:new(name) &#x000A;  return setmetatable({ name=name }, self) &#x000A;end &#x000A;function Person:print() &#x000A;  print(self.name) &#x000A;end &#x000A;_.invoke({ Person:new("Tom"), Person:new("Dick"), Person:new("Harry") }, "print") &#x000A;=> Calls person:print() on each Person</pre>
        </div>
        <div id='pluck'>
          <p>
            <strong>pluck</strong>
            <code>_.pluck(iter, property_name)</code>
          </p>
          <p class='description'>An convenient version of the common use-case of mapextracting a list of properties.</p>
          <pre>_.pluck({ {id=1}, {id=2}, {id=3} }, 'id') &#x000A;=> { 1, 2, 3 }</pre>
        </div>
        <h3>Reduce Functions</h3>
        <div id='to_array'>
          <p>
            <strong>to_array</strong>
            <code>_.to_array(iter)</code>
          </p>
          <p class='description'>Collects all values into a new array.</p>
          <pre>_.to_array(string.gmatch("dog cat goat", "%S+")) &#x000A;=> { "dog", "cat", "goat" }</pre>
        </div>
        <div id='sort'>
          <p>
            <strong>sort</strong>
            <code>_.sort(iter, [comparison_func])</code>
          </p>
          <p class='description'>Returns an array with all elements sorted by the comparison function, by default it uses the < operator. If an array is passed in it will sort the elements in place and not create a new array.</p>
          <pre>_.sort({ 3, 1, 2}) &#x000A;=> { 1, 2, 3 }</pre>
        </div>
        <h3>Table Functions</h3>
        <div id='extend'>
          <p>
            <strong>extend</strong>
            <code>_.extend(destination, source)</code>
          </p>
          <p class='description'>Copy all of the properties in the source object over to the destination object.</p>
          <pre>_.extend({ name = 'moe' }, { age = 50 }) &#x000A;=> { name = 'moe', age = 50 }</pre>
        </div>
        <h3>Function Functions</h3>
        <div id='wrap'>
          <p>
            <strong>wrap</strong>
            <code>_.wrap(func, wrapper)</code>
          </p>
          <p class='description'>Wraps the first function inside of the wrapper function, passing it as the first argument. This allows the wrapper to execute code before and after the function runs, adjust the arguments, and execute it conditionally.</p>
          <pre>hello = function(name) &#x000A;  return "hello: "..name &#x000A;end &#x000A;hello = _.wrap(hello, function(func, ...) &#x000A;  return "before, "..func(...)..", after" &#x000A;end) &#x000A;hello('moe') &#x000A;=> before, hello: moe, after</pre>
        </div>
      </div>
    </div>
  </body>
</html>
